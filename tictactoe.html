<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe</title>
<style>
  :root {
    --cell-size: 120px;
    --gap: 5px;
    --line-thickness: 6px;
    --win-color: #28a745;
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #fff;
    display: grid;
    place-items: center;
    min-height: 100vh;
  }

  .container {
    text-align: center;
    position: relative;
    padding: 20px;
  }

  .back-btn {
    position: absolute;
    top: 12px;
    left: 12px;
    padding: 10px 20px;
    font-size: 16px;
    background-color: #000;
    color: #fff;
    border: none;
    border-radius: 6px;
    text-decoration: none;
    transition: background-color 0.2s ease;
  }
  .back-btn:hover { background-color: #333; }

  h1 { margin: 16px 0 16px; }

  .board {
    display: grid;
    grid-template-columns: repeat(3, var(--cell-size));
    grid-template-rows: repeat(3, var(--cell-size));
    gap: var(--gap);
    position: relative;
    margin: 0 auto 20px;
    background: #333;
    padding: var(--gap);
    border-radius: 12px;
  }

  .cell {
    background: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 60px;
    font-weight: bold;
    cursor: pointer;
    border: 1px solid blue;
  }
  .cell.taken { cursor: not-allowed; }

  .status {
    font-size: 24px;
    margin-bottom: 20px;
    min-height: 30px;
  }

  .score-container {
    display: flex;
    justify-content: center;
    gap: 50px;
    margin-bottom: 20px;
  }
  .score-item { text-align: center; }
  .score-label { font-weight: bold; font-size: 18px; margin-bottom: 5px; }
  .score-value { font-size: 24px; font-weight: bold; }
  .score-x .score-label { color: #dc3545; }
  .score-o .score-label { color: #007bff; }

  .btn {
    padding: 12px 28px;
    font-size: 16px;
    background-color: #28a745;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  .btn:hover { background-color: #218838; }

  .win-line {
    position: absolute;
    height: var(--line-thickness);
    background: var(--win-color);
    border-radius: 999px;
    pointer-events: none;
    box-shadow: 0 0 6px rgba(0,0,0,0.2);
  }
</style>
</head>
<body>
<div class="container">
  <a href="index.html" class="back-btn">Back</a>
  <h1>Tic Tac Toe</h1>
  <div class="status" id="turnIndicator">X Turn</div>
  <div class="board" id="gameBoard"></div>

  <div class="score-container">
    <div class="score-item score-x">
      <div class="score-label">X Score</div>
      <div class="score-value" id="xScore">0</div>
    </div>
    <div class="score-item score-o">
      <div class="score-label">O Score</div>
      <div class="score-value" id="oScore">0</div>
    </div>
  </div>

  <button class="btn" id="playAgainBtn">Play Again</button>
</div>

<script>
  const boardEl = document.getElementById('gameBoard');
  const turnIndicator = document.getElementById('turnIndicator');
  const xScoreEl = document.getElementById('xScore');
  const oScoreEl = document.getElementById('oScore');
  const playAgainBtn = document.getElementById('playAgainBtn');

  let currentPlayer = 'X';
  let board = Array(9).fill('');
  let gameActive = true;
  let xScore = 0;
  let oScore = 0;
  let cells = [];
  let winLineEl = null;
  let lastWinningCombo = null;

  const winningCombos = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];

  // Load scores from localStorage
  const savedScores = JSON.parse(localStorage.getItem('tictactoeScores') || '{}');
  xScore = savedScores.x || 0;
  oScore = savedScores.o || 0;
  updateScoreDisplay();

  // Build cells
  for(let i=0;i<9;i++){
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.dataset.index = i;
    cell.addEventListener('click', () => handleTileClick(i));
    boardEl.appendChild(cell);
    cells.push(cell);
  }

  function handleTileClick(idx){
    if(!gameActive || board[idx]) return;

    board[idx] = currentPlayer;
    cells[idx].textContent = currentPlayer;
    cells[idx].classList.add('taken');

    const combo = getWinningCombo();
    if(combo){
      gameActive=false;
      turnIndicator.textContent = `Winner: ${currentPlayer}`;
      currentPlayer==='X'? xScore++ : oScore++;
      saveScores();
      updateScoreDisplay();
      lastWinningCombo = combo;
      drawWinningLine(combo);
      return;
    }

    if(board.every(Boolean)){
      gameActive=false;
      turnIndicator.textContent = 'Draw!';
      return;
    }

    currentPlayer = currentPlayer==='X'? 'O':'X';
    updateTurnIndicator();
  }

  function getWinningCombo(){
    for(const [a,b,c] of winningCombos){
      if(board[a] && board[a]===board[b] && board[a]===board[c]) return [a,b,c];
    }
    return null;
  }

  function drawWinningLine([a,,,]){
    clearWinningLine();
    const [first, , last] = arguments[0];

    const rectA = cells[first].getBoundingClientRect();
    const rectC = cells[last].getBoundingClientRect();
    const boardRect = boardEl.getBoundingClientRect();

    const ax = rectA.left + rectA.width/2 - boardRect.left;
    const ay = rectA.top + rectA.height/2 - boardRect.top;
    const cx = rectC.left + rectC.width/2 - boardRect.left;
    const cy = rectC.top + rectC.height/2 - boardRect.top;

    const dx = cx - ax, dy = cy - ay;
    const length = Math.hypot(dx, dy);
    const angle = Math.atan2(dy, dx) * 180 / Math.PI;
    const midX = (ax+cx)/2, midY=(ay+cy)/2;

    winLineEl = document.createElement('div');
    winLineEl.className='win-line';
    winLineEl.style.width = `${length}px`;
    const thickness = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--line-thickness'))||6;
    winLineEl.style.height = `${thickness}px`;
    winLineEl.style.left = `${midX-length/2}px`;
    winLineEl.style.top = `${midY-thickness/2}px`;
    winLineEl.style.transform = `rotate(${angle}deg)`;
    boardEl.appendChild(winLineEl);
  }

  function clearWinningLine(){
    if(winLineEl){ winLineEl.remove(); winLineEl=null; }
  }

  function updateScoreDisplay(){
    xScoreEl.textContent = xScore;
    oScoreEl.textContent = oScore;
  }

  function updateTurnIndicator(){
    turnIndicator.textContent = `${currentPlayer} Turn`;
  }

  function resetGame(){
    board.fill('');
    gameActive=true;
    currentPlayer='X';
    cells.forEach(cell=>{
      cell.textContent='';
      cell.classList.remove('taken');
    });
    updateTurnIndicator();
    clearWinningLine();
  }

  function saveScores(){
    localStorage.setItem('tictactoeScores', JSON.stringify({x:xScore,o:oScore}));
  }

  playAgainBtn.addEventListener('click', resetGame);

  window.addEventListener('resize', ()=>{
    if(!gameActive && lastWinningCombo) drawWinningLine(lastWinningCombo);
  });

  updateTurnIndicator();
</script>
</body>
</html>
